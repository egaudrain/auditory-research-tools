addpath('../');

fs = 44100;
d = 200;

variant = 'figure';
[x, fs] = TENnoise(d, fs, variant);
rms_ref = rms(x);

X = fft(x);
f = linspace(0,fs,length(x));

figure(1)
semilogx(f, 20*log10(abs(X)));
xlim([25, 20000]);
ylim([-50, 70]);
hold on

figure(2)
n = 2^11;
w = hann(n);
[~, f, t, Pxx] = spectrogram(x, w, n/2, n, fs);
Pm = mean(Pxx, 2);
semilogx(f, 10*log10(Pm), 'DisplayName', sprintf('TENnoise.m %s', variant))
Pm_1k = interp1(f, 10*log10(Pm), 1e3);

ms_data = [ 75.65108360709866, 40.17834407084111; ...
            77.98366597201033, 40.60747013704817; ...
            79.84594662004146, 40.928815047474004; ...
            81.4847498833682, 41.26043838664115; ...
            83.44355209963992, 41.680106774970724; ...
            85.72763487115101, 42.06879705500032; ...
            88.07154886636621, 42.438081385443645; ...
            89.88338916074002, 42.79946051397639; ...
            92.35108302491517, 43.238606262930276; ...
            94.87435242328789, 43.59624702362184; ...
            97.14572660914284, 43.95511010324779; ...
            99.47472079584237, 44.33467286243243; ...
            103.20903105314072, 44.69197340053563; ...
            108.49962969996, 45.01185659502339; ...
            114.82463353824446, 45.37660870491936; ...
            121.51736460407334, 45.736185894925676; ...
            128.17243207583223, 46.074991994335264; ...
            135.64343643609507, 46.43586291431399; ...
            143.5483080143325, 46.78961831944442; ...
            151.4090056755642, 47.12454322893676; ...
            159.7016183055195, 47.46528992330497; ...
            168.44481206787657, 47.792452452962806; ...
            177.67643963811315, 48.15454569187591; ...
            187.4071369568557, 48.4933517912855; ...
            198.98959908917868, 48.86490270807609; ...
            213.34596190308164, 49.10689498056572; ...
            229.46829428658563, 49.27782703797355; ...
            246.8084262184915, 49.44734775359329; ...
            265.4659698027522, 49.63380457067014; ...
            285.5256882475415, 49.801913944501784; ...
            307.08823965881214, 49.94320782435969; ...
            330.23441085790887, 49.998409855143976; ...
            355.1267570926131, 50.05643456950445; ...
            381.8827071521745, 50.093289157043536; ...
            410.6608897709432, 50.14002313709927; ...
            441.5773449158233, 50.143005521724156; ...
            474.8234439308436, 50.14881058992522; ...
            510.5658162068471, 50.14614760739774; ...
            548.9621081662399, 50.10114437122749; ...
            590.2538005040419, 50.0646091857858; ...
            634.6006025450689, 49.97726569597279; ...
            682.2640994298438, 49.87580878827886; ...
            733.5123887750761, 49.778585905949214; ...
            788.6242116042379, 49.6926537579243; ...
            847.7713313157099, 49.52768646976623; ...
            911.279594639122, 49.310499535448756; ...
            979.4692240316459, 49.043915638548064; ...
            1052.8128346034757, 48.8083812609854; ...
            1131.7666594381922, 48.639179947463056; ...
            1216.6198618726876, 48.458687899635976; ...
            1307.7593138666482, 48.24150096531851; ...
            1405.6793604492043, 48.00314390417965; ...
            1510.8641524687273, 47.73656000727896; ...
            1623.8945033366808, 47.460096717861624; ...
            1745.2373795847204, 47.13141378228488; ...
            1875.6349035746812, 46.79849682134386; ...
            2015.7797149257028, 46.46699120219094; ...
            2166.3333808023654, 46.117138139792814; ...
            2328.245328620848, 45.79833459673272; ...
            2502.2975049979073, 45.48941044618927; ...
            2689.4150408646487, 45.19318837173864; ...
            2890.5184847502587, 44.895554955499925; ...
            3106.8252752183225, 44.63179374217542; ...
            3339.30416023973, 44.36520984527473; ...
            3589.322614059498, 44.12403010055969; ...
            3858.120306091577, 43.8927297483613; ...
            4146.983262950953, 43.651550003646264; ...
            4457.453994038983, 43.40754757535504; ...
            4791.104760658588, 43.15507709633527; ...
            5149.569886552908, 42.88284783228221; ...
            5534.830380607914, 42.607795884652965; ...
            5948.821279598809, 42.32286454450708; ...
            6393.820235195148, 42.042167229725464; ...
            6871.939197786525, 41.74594515527484; ...
            7385.958763703701, 41.46242515691704; ...
            7938.6208898449495, 41.19442991822826; ...
            8532.522798974673, 40.91796662881092; ...
            9171.69094469572, 40.699368352705356; ...
            9858.56371689938, 40.46947934229506; ...
            10597.159274968233, 40.25652643334186; ...
            11391.26696528587, 40.053452916905314; ...
            12245.208290658058, 39.86731550192586; ...
            13163.574384648166, 39.70093687197971; ...
            14151.004731247096, 39.54302629276209; ...
            14866.780000955318, 39.45200740665963];

f1 = [	20, 25, 30, 35, 40, 45, 50, 55, 60, 70, 80, 90, 100, ...
    125, 150, 177, 200, 250, 300, 350, 400, 450, 500, 550, ...
    600, 700, 800, 900, 1000, 1500, 2000, 2500, 2828, 3000, ...
    3500, 4000, 4500, 5000, 5500, 6000, 7000, 8000, 9000, 10000, ...
    12748, 15000];

ELC = [ 31.8, 26.0, 21.7, 18.8, 17.2, 15.4, 14.0, 12.6, 11.6, 10.6, ...
    9.2, 8.2, 7.7, 6.7, 5.3, 4.6, 3.9, 2.9, 2.7, 2.3, ...
    2.2, 2.3, 2.5, 2.7, 2.9, 3.4, 3.9, 3.9, 3.9, 2.7, ...
    0.9, -1.3, -2.5, -3.2, -4.4, -4.1, -2.5, -0.5, 2.0, 5.0, ...
    10.2, 15.0, 17.0, 15.5, 11.0, 22.0];

% ms_data(:,2) = ms_data(:,2)/2;

hold on
plot(ms_data(:,1), ms_data(:,2)-interp1(ms_data(:,1), ms_data(:,2), 1e3)+Pm_1k, 'DisplayName', 'Moore et al. (2000), Fig. 1');


xlim([25, 20000])

legend()
%plot(f1, ELC, 'DisplayName', 'ELC');

figure(1)
hold off

figure(2)
hold off
